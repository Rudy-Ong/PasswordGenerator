name: Changelog CI

on:
  push:
    branches: [ main ]
  workflow_dispatch: {}

jobs:
  changelog:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Generate changelog
        run: |
          mkdir -p logs
          commit_msg=$(git log -1 --pretty=%s)
          {
            echo "#version ${commit_msg}"
            echo "Generated on $(date -u '+%Y-%m-%d %H:%M:%SZ')"
            echo ""
            git log --date=short --pretty=format:'- %h %ad %s'
          } > logs/CHANGELOG.md

      - name: Upload changelog artifact
        uses: actions/upload-artifact@v4
        with:
          name: changelog
          path: logs/CHANGELOG.md
